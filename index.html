<button id="shuffle">Shuffle</button>

<div id="player" style="
    width:300px;
    margin-top:20px;
    padding:20px;
    border-radius:20px;
    overflow:hidden;
    position:relative;
    font-family:sans-serif;
    display:none;
    ">
    
    <div id="bg" style="
        position:absolute;
        inset:0;
        background-size:cover;
        background-position:center;
        filter:blur(25px) brightness(0.5);
        z-index:-1;
    "></div>

    <img id="cover" style="width:100%; border-radius:15px;">

    <h2 id="title" style="color:white;margin:10px 0 0;"></h2>
    <h3 id="artist" style="color:white;margin:0 0 10px;"></h3>

    <div id="progress" style="
        width:100%;
        height:6px;
        background:rgba(255,255,255,0.3);
        border-radius:3px;
        overflow:hidden;
    ">
        <div id="bar" style="
            height:100%;
            background:white;
            width:0%;
        "></div>
    </div>
</div>

<script>
async function getTracks() {
    try {
        const playlistId = "pl.u-ovURBX17aZ";

        const url = `https://itunes.apple.com/lookup?id=${playlistId}&entity=song`;

        const res = await fetch(url);
        if (!res.ok) throw new Error("Apple API error " + res.status);

        const data = await res.json();

        if (!data.results || data.results.length < 2)
            throw new Error("Playlist returned no songs");

        // first item is playlist metadata, remove it
        return data.results.slice(1);

    } catch (e) {
        alert("Error loading playlist:\n" + e.message);
        console.error(e);
        return null;
    }
}

document.getElementById("shuffle").addEventListener("click", async () => {
    const tracks = await getTracks();
    if (!tracks) return;

    const track = tracks[Math.floor(Math.random() * tracks.length)];

    const title = track.trackName;
    const artist = track.artistName;
    const cover = track.artworkUrl100.replace("100x100", "600x600");

    document.getElementById("player").style.display = "block";
    document.getElementById("title").textContent = title;
    document.getElementById("artist").textContent = artist;
    document.getElementById("cover").src = cover;

    document.getElementById("bg").style.backgroundImage = `url(${cover})`;

    // random progress fill
    const percent = Math.random() * 100;
    document.getElementById("bar").style.width = percent + "%";
});
</script>
